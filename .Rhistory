<<<<<<< HEAD
#Get genotype data
SNPs <- read.csv("03_bigRRinput/binSNP_bigRR_MAF20hp.OA.csv", row.names = 1)
FullSNPs <- SNPs
SNPs <- FullSNPs
#add a column with position as chr.base
SNPs$Chr.Base <- do.call(paste, c(SNPs[c("X.CHROM","POS")], sep="."))
View(SNPs)
View(SNPs)
rownames(SNPs) <- SNPs[,96] #set the new column of chrom.base as rownames - this could maybe be written as: rownames(SNPs) <- SNPs$Chr.Base?
View(SNPs)
SNPs <- SNPs[,4:95] #take out first three cols (X.CHROM, POS, REF) and new last col (Chr.Base). dim(SNPs) should now be [345485, 91], colnames(SNPs) are all Bc Isolates, rownames(SNPs) are all Chr.Base
SNPs <- as.matrix(t(SNPs))
for(i in 1:dim(SNPs)[1]) {
SNPs[i,] <- as.numeric(SNPs[i,])
}
Phenos <- read.csv("03_bigRRinput/Gm_OA.Pheno_bigRR.csv", row.names = 1)
View(Phenos)
dat <- as.data.frame((Phenos[,2]))  #INSERT PHENOTYPE COLUMNS HERE
outpt.HEM <- colnames(SNPs)
thresh.HEM <- list("0.95Thresh" = NA, "0.975Thresh" = NA, "0.99Thresh" = NA, "0.999Thresh" = NA)
#Calculate HEMs for all phenotypes
for(i in 1:dim(dat)[2]) { #i will be each isolate
print(colnames(dat)[i])
MyX <- matrix(1, dim(dat)[1], 1)
Pheno.BLUP.result <- bigRR(y = dat[,i], X = MyX, Z = SNPs, GPU = TRUE)
Pheno.HEM.result <- bigRR_update(Pheno.BLUP.result, SNPs)
outpt.HEM <- cbind(outpt.HEM, Pheno.HEM.result$u)
#Permute Thresholds for Phenos - this is what takes forever
perm.u.HEM <- vector()
for(p in 1:1000) {
if(p %% 10 == 0) {print(paste("Thresh sample:", p, "--", Sys.time()))}
try(temp.Pheno <- sample(dat[,i], length(dat[,i]), replace = FALSE))
try(temp.BLUP  <- bigRR(y = temp.Pheno, X = MyX, Z = SNPs, GPU = TRUE),silent = TRUE)
temp.HEM <- bigRR_update(temp.BLUP, SNPs) #REF change- was bigRR_update(Pheno.BLUP.result...
perm.u.HEM <- c(perm.u.HEM, temp.HEM$u)
}
#write.csv(perm.u.HEM, paste("PermEffects_",colnames(dat)[i],".csv",sep=""))
thresh.HEM$"0.95Thresh"[i] <- quantile(abs(perm.u.HEM),0.95)
thresh.HEM$"0.975Thresh"[i] <- quantile(abs(perm.u.HEM),0.975)
thresh.HEM$"0.99Thresh"[i] <- quantile(abs(perm.u.HEM),0.99)
thresh.HEM$"0.999Thresh"[i] <- quantile(abs(perm.u.HEM),0.999)
colnames(outpt.HEM)[i+1] <- paste(colnames(dat)[i],"HEM",sep=".")
}
#Give column names to the thresholds from the HEM list
for(j in 1:length(thresh.HEM)) {
names(thresh.HEM[[j]]) <- colnames(dat)
}
#RF-give row names to thresh.HEM and thresh.BLUP so that threshhold values will line up correctly with phenotypes, and you can see which threshold value is displayed
thresh.HEM$"0.95Thresh" <- c("0.95 Thresh", thresh.HEM$"0.95Thresh")
thresh.HEM$"0.975Thresh" <- c("0.975 Thresh", thresh.HEM$"0.975Thresh")
thresh.HEM$"0.99Thresh" <- c("0.99 Thresh", thresh.HEM$"0.99Thresh")
thresh.HEM$"0.999Thresh" <- c("0.999 Thresh", thresh.HEM$"0.999Thresh")
#Write results to output
write.csv(rbind(thresh.HEM$"0.95Thresh",thresh.HEM$"0.975Thresh",thresh.HEM$"0.99Thresh",thresh.HEM$"0.999Thresh",outpt.HEM),"04_bigRRoutput/Gm_OA.Pheno_HEM.csv")
setwd("~/Documents/GitRepos/BcEudicotGWAS/data/RG_soybean/")
SNPs <- read.csv("02_csvprep/Domest/hp_binaryMAF20.csv", row.names = 1)
SNPs_rename <- SNPs
SNPnames <- read.csv("02_csvprep/Domest/Key_SNPnames.csv")
SNPnames <- SNPnames[c(2,4)]
Pheno.D <- read.csv("02_csvprep/Domest/RG_phenoDandW.csv")
names( SNPs_rename ) <- SNPnames[ match( names( SNPs_rename ) , SNPnames[ , 'SNPname' ] ) ,'GenoRename' ]
Pheno.D$REF <- SNPnames[ match( Pheno.D$REF , SNPnames[ , 'SNPname' ] ) ,'GenoRename' ]
View(Pheno.D)
library(plyr)
unique(Pheno.D$REF)
unique(SNPnames$GenoRename)
SNPMt <- as.data.frame(names(SNPs_rename))
PhenoMatch.D <- Pheno.D
PhenoMatch.D <- PhenoMatch.D[PhenoMatch.D$REF%in% SNPMt$"names(SNPs_rename)", ]
View(PhenoMatch.D)
PhenoMt.D <- as.data.frame(PhenoMatch.D[,1])
SNPMatch.D <- SNPs_rename
View(SNPs_rename)
SNPs3 <- SNPs_rename[,c(1:3)]
SNPMatch.D <- SNPMatch.D[names(SNPMatch.D) %in% (PhenoMt.D[,1])]
SNPMatch.D <- SNPMatch.D[ , order(names(SNPMatch.D))]
SNPMatch2.D <- cbind(SNPs3,SNPMatch.D)
PhenoMatch2.D <- PhenoMatch.D[order(PhenoMatch.D$REF),]
View(SNPMatch2.D)
write.csv(SNPMatch2.D, "03_bigRRinput/Domest/binSNP_bigRR_MAF20hp.D.csv")
write.csv(PhenoMatch2.D, "03_bigRRinput/Domest/Gm_Les.Pheno_bigRR.D.csv")
rm(list=ls())
setwd("~/Documents/GitRepos/BcEudicotGWAS/data/RG_soybean/")
bigRR_update <- function (obj, Z, family = gaussian(link = identity), tol.err = 1e-06,
tol.conv = 1e-08)
{
w <- as.numeric(obj$u^2/(1 - obj$leverage))
w[w < tol.err] <- tol.err
bigRR(y = obj$y, X = obj$X, Z = Z, family = family, weight = w,
tol.err = tol.err, tol.conv = tol.conv, GPU = TRUE )
}
library(bigRR) #check if version is 1.3-9
SNPs <- read.csv("03_bigRRinput/Domest/binSNP_bigRR_MAF20hp.D.csv", row.names = 1)
FullSNPs <- SNPs
SNPs <- FullSNPs
SNPs$Chr.Base <- do.call(paste, c(SNPs[c("X.CHROM","POS")], sep="."))
View(SNPs)
rownames(SNPs) <- SNPs[,98] #set the new column of chrom.base as rownames - this could maybe be written as: rownames(SNPs) <- SNPs$Chr.Base?
any(duplicated(SNPs$Chr.Base))#check that none are duplicated
SNPs <- SNPs[,4:97] #take out first three cols (X.CHROM, POS, REF) and new last col (Chr.Base). dim(SNPs) should now be [345485, 91], colnames(SNPs) are all Bc Isolates, rownames(SNPs) are all Chr.Base
SNPs <- as.matrix(t(SNPs))
for(i in 1:dim(SNPs)[1]) {
SNPs[i,] <- as.numeric(SNPs[i,])
}
Phenos <- read.csv("03_bigRRinput/Domest/Gm_Les.Pheno_bigRR.D.csv", row.names = 1)
View(Phenos)
dat <- as.data.frame((Phenos[,2:6]))  #INSERT PHENOTYPE COLUMNS HERE
outpt.HEM <- colnames(SNPs)
thresh.HEM <- list("0.95Thresh" = NA, "0.975Thresh" = NA, "0.99Thresh" = NA, "0.999Thresh" = NA)
for(i in 1:dim(dat)[2]) { #i will be each isolate
print(colnames(dat)[i])
MyX <- matrix(1, dim(dat)[1], 1)
Pheno.BLUP.result <- bigRR(y = dat[,i], X = MyX, Z = SNPs, GPU = TRUE)
Pheno.HEM.result <- bigRR_update(Pheno.BLUP.result, SNPs)
outpt.HEM <- cbind(outpt.HEM, Pheno.HEM.result$u)
#Permute Thresholds for Phenos - this is what takes forever
perm.u.HEM <- vector()
for(p in 1:1000) {
if(p %% 10 == 0) {print(paste("Thresh sample:", p, "--", Sys.time()))}
try(temp.Pheno <- sample(dat[,i], length(dat[,i]), replace = FALSE))
try(temp.BLUP  <- bigRR(y = temp.Pheno, X = MyX, Z = SNPs, GPU = TRUE),silent = TRUE)
temp.HEM <- bigRR_update(temp.BLUP, SNPs) #REF change- was bigRR_update(Pheno.BLUP.result...
perm.u.HEM <- c(perm.u.HEM, temp.HEM$u)
}
#write.csv(perm.u.HEM, paste("PermEffects_",colnames(dat)[i],".csv",sep=""))
thresh.HEM$"0.95Thresh"[i] <- quantile(abs(perm.u.HEM),0.95)
thresh.HEM$"0.975Thresh"[i] <- quantile(abs(perm.u.HEM),0.975)
thresh.HEM$"0.99Thresh"[i] <- quantile(abs(perm.u.HEM),0.99)
thresh.HEM$"0.999Thresh"[i] <- quantile(abs(perm.u.HEM),0.999)
colnames(outpt.HEM)[i+1] <- paste(colnames(dat)[i],"HEM",sep=".")
=======
geom_hline(yintercept=get(paste("TH95_", names(HEM.plotdata[y]), sep="")), colour = "blue") +
geom_text(aes(0,get(paste("TH95_", names(HEM.plotdata[y]), sep="")), label = ".95 Threshold", vjust = 1.5, hjust = .05), col = "blue")+
geom_hline(yintercept=get(paste("TH99_", names(HEM.plotdata[y]), sep="")), colour = "black") +
geom_text(aes(0,get(paste("TH99_", names(HEM.plotdata[y]), sep="")), label = ".99 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=0)
dev.off()
}
for (y in 4){ #[y]
jpeg(paste("05_plots/Gm_LesionSize_MAF20_lowTR_", names(HEM.plotdata[y]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[y])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[y]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH95_", names(HEM.plotdata[y]), sep="")), colour = "blue") +
geom_text(aes(0,get(paste("TH95_", names(HEM.plotdata[y]), sep="")), label = ".95 Threshold", vjust = 1.5, hjust = .05), col = "blue")+
geom_hline(yintercept=get(paste("TH99_", names(HEM.plotdata[y]), sep="")), colour = "black") +
geom_text(aes(0,get(paste("TH99_", names(HEM.plotdata[y]), sep="")), label = ".99 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=0)
dev.off()
}
for (y in 4){ #[y]
jpeg(paste("05_plots/Gm_LesionSize_MAF20_lowTR_", names(HEM.plotdata[y]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[y])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[y]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH95_", names(HEM.plotdata[y]), sep="")), colour = "blue") +
geom_text(aes(0,get(paste("TH95_", names(HEM.plotdata[y]), sep="")), label = ".95 Threshold", vjust = 1.5, hjust = .05), col = "blue")+
geom_hline(yintercept=get(paste("TH99_", names(HEM.plotdata[y]), sep="")), colour = "black") +
geom_text(aes(0,get(paste("TH99_", names(HEM.plotdata[y]), sep="")), label = ".99 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=0)
dev.off()
}
for (m in 4){ #[y]
jpeg(paste("05_plots/Gm_LesionSize_MAF20_lowTR_", names(HEM.plotdata[m]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[m])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[m]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH95_", names(HEM.plotdata[m]), sep="")), colour = "blue") +
geom_text(aes(0,get(paste("TH95_", names(HEM.plotdata[m]), sep="")), label = ".95 Threshold", vjust = 1.5, hjust = .05), col = "blue")+
geom_hline(yintercept=get(paste("TH99_", names(HEM.plotdata[m]), sep="")), colour = "black") +
geom_text(aes(0,get(paste("TH99_", names(HEM.plotdata[m]), sep="")), label = ".99 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=0)
dev.off()
>>>>>>> b57599025786d6d0501078d2f34c900153021f3f
}
for (m in 4){ #[m]
jpeg(paste("05_plots/Gm_LesionSize_MAF20_lowTR_", names(HEM.plotdata[m]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[m])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))
dev.off
}
dev.off
for (m in 4){ #[m]
#jpeg(paste("05_plots/Gm_LesionSize_MAF20_lowTR_", names(HEM.plotdata[m]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[m])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))
#  dev.off
}
jpeg(paste("05_plots/Gm_LesionSize_MAF20_lowTR_", names(HEM.plotdata[4]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[4])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[4]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH95_", names(HEM.plotdata[4]), sep="")), colour = "blue") +
geom_text(aes(0,get(paste("TH95_", names(HEM.plotdata[4]), sep="")), label = ".95 Threshold", vjust = 1.5, hjust = .05), col = "blue")+
geom_hline(yintercept=get(paste("TH99_", names(HEM.plotdata[4]), sep="")), colour = "black") +
geom_text(aes(0,get(paste("TH99_", names(HEM.plotdata[4]), sep="")), label = ".99 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=0)
dev.off()
}
<<<<<<< HEAD
#RF-give row names to thresh.HEM and thresh.BLUP so that threshhold values will line up correctly with phenotypes, and you can see which threshold value is displayed
thresh.HEM$"0.95Thresh" <- c("0.95 Thresh", thresh.HEM$"0.95Thresh")
thresh.HEM$"0.975Thresh" <- c("0.975 Thresh", thresh.HEM$"0.975Thresh")
thresh.HEM$"0.99Thresh" <- c("0.99 Thresh", thresh.HEM$"0.99Thresh")
thresh.HEM$"0.999Thresh" <- c("0.999 Thresh", thresh.HEM$"0.999Thresh")
#Write results to output
write.csv(rbind(thresh.HEM$"0.95Thresh",thresh.HEM$"0.975Thresh",thresh.HEM$"0.99Thresh",thresh.HEM$"0.999Thresh",outpt.HEM),"04_bigRRoutput/Domest/Gm_Les.Pheno_HEM.D.csv")
View(FullSNPs)
rm(list=ls())
setwd("~/Documents/GitRepos/BcEudicotGWAS/data/RG_soybean/")
SNPs <- read.csv("02_csvprep/Domest/hp_binaryMAF20.csv", row.names = 1)
SNPs_rename <- SNPs
SNPnames <- read.csv("02_csvprep/Domest/Key_SNPnames.csv")
SNPnames <- SNPnames[c(2,4)]
#read in model data with 2 trays dropped
Pheno.D <- read.csv("02_csvprep/Domest/RG_phenoDandW.csv")
#change names from genotype file to isolate names
#File SNPs_rename has columns of isolate genotypes that I want to rename
#File SNPnames is a list indexing original names to match (SNPname), and actual name to replace it (GenoRename)
names( SNPs_rename ) <- SNPnames[ match( names( SNPs_rename ) , SNPnames[ , 'SNPname' ] ) ,'GenoRename' ]
#change names from phenotype file to isolate names
Pheno.D$REF <- SNPnames[ match( Pheno.D$REF , SNPnames[ , 'SNPname' ] ) ,'GenoRename' ]
library(plyr)
unique(Pheno.D$REF)
unique(SNPnames$GenoRename)
## now only keep genotypes and phenotypes that match
#save practice file
#miniSNPs <- SNPs_rename[c(1:3),]
#write.csv(miniSNPs, "miniSNP_practice.csv")
#only keep phenotype rows that match SNP names
SNPMt <- as.data.frame(names(SNPs_rename))
PhenoMatch.D <- Pheno.D
PhenoMatch.D <- PhenoMatch.D[PhenoMatch.D$REF%in% SNPMt$"names(SNPs_rename)", ]
#only keep SNP rows that match phenotype names
#select column with isolate names
PhenoMt.D <- as.data.frame(PhenoMatch.D[,1])
SNPMatch.D <- SNPs_rename
#save first 3 columns: won't match Pheno names
SNPs3 <- SNPs_rename[,c(1:3)]
SNPMatch.D <- SNPMatch.D[names(SNPMatch.D) %in% (PhenoMt.D[,1])]
SNPMatch.D <- SNPMatch.D[ , order(names(SNPMatch.D))]
SNPMatch2.D <- cbind(SNPs3,SNPMatch.D)
#sort pheno match
PhenoMatch2.D <- PhenoMatch.D[order(PhenoMatch.D$REF),]
View(SNPMatch2.D)
SNPMatch2.D <- SNPMatch2.D[,-9]
View(SNPMatch2.D)
write.csv(SNPMatch2.D, "03_bigRRinput/Domest/binSNP_bigRR_MAF20hp.D.csv")
rm(list=ls())
setwd("~/Documents/GitRepos/BcEudicotGWAS/data/RG_soybean/")
#########################
# This makes the bigRR_update run through the GPU
# You need to do this first to mask the native 'bigRR_update' in the bigRR package
# one alternative to family = gaussian(link = identity) is family = poisson(link = log)
## RAN first time WITH POISSON. Lesion size expected to be Gaussian
bigRR_update <- function (obj, Z, family = gaussian(link = identity), tol.err = 1e-06,
tol.conv = 1e-08)
{
w <- as.numeric(obj$u^2/(1 - obj$leverage))
w[w < tol.err] <- tol.err
bigRR(y = obj$y, X = obj$X, Z = Z, family = family, weight = w,
tol.err = tol.err, tol.conv = tol.conv, GPU = TRUE )
}
########################
#NOTE1 FROM RACHEL:  we need bigRR1.3-9 to get GPU option
# must download R-Forge version bigRR1.3-9tar.gz and manually install
# https://r-forge.r-project.org/R/?group_id=1301
# install.packages("bigRR", repos="http://R-Forge.R-project.org")
#NOTE2 FROM RACHEL: need package 'gputools' but CRAN version fails to install
# must first install Nvidia's CUDA toolkit -current version is 7.5
# installed from developer.nvidia.com/cuda-downloads
library(bigRR) #check if version is 1.3-9
#Get genotype data
SNPs <- read.csv("03_bigRRinput/Domest/binSNP_bigRR_MAF20hp.D.csv", row.names = 1)
FullSNPs <- SNPs
SNPs <- FullSNPs
#add a column with position as chr.base
SNPs$Chr.Base <- do.call(paste, c(SNPs[c("X.CHROM","POS")], sep="."))
rownames(SNPs) <- SNPs[,98] #set the new column of chrom.base as rownames - this could maybe be written as: rownames(SNPs) <- SNPs$Chr.Base?
any(duplicated(SNPs$Chr.Base))#check that none are duplicated
SNPs <- SNPs[,4:97] #take out first three cols (X.CHROM, POS, REF) and new last col (Chr.Base). dim(SNPs) should now be [345485, 91], colnames(SNPs) are all Bc Isolates, rownames(SNPs) are all Chr.Base
#makes SNP states numeric (also transposes SNP matrix)
SNPs <- as.matrix(t(SNPs))
for(i in 1:dim(SNPs)[1]) {
SNPs[i,] <- as.numeric(SNPs[i,])
}
#read in phenotype data
Phenos <- read.csv("03_bigRRinput/Domest/Gm_Les.Pheno_bigRR.D.csv", row.names = 1)
View(Phenos)
#Nicole E Soltis
#match Bc isolates from genotype data to Bc isolates in Gm phenotype data
#-----------------------------------------------------------
rm(list=ls())
setwd("~/Documents/GitRepos/BcEudicotGWAS/data/RG_soybean/")
SNPs <- read.csv("02_csvprep/Domest/hp_binaryMAF20.csv", row.names = 1)
SNPs_rename <- SNPs
SNPnames <- read.csv("02_csvprep/Domest/Key_SNPnames.csv")
SNPnames <- SNPnames[c(2,4)]
#read in model data with 2 trays dropped
Pheno.D <- read.csv("02_csvprep/Domest/RG_phenoDandW.csv")
#change names from genotype file to isolate names
#File SNPs_rename has columns of isolate genotypes that I want to rename
#File SNPnames is a list indexing original names to match (SNPname), and actual name to replace it (GenoRename)
names( SNPs_rename ) <- SNPnames[ match( names( SNPs_rename ) , SNPnames[ , 'SNPname' ] ) ,'GenoRename' ]
#change names from phenotype file to isolate names
Pheno.D$REF <- SNPnames[ match( Pheno.D$REF , SNPnames[ , 'SNPname' ] ) ,'GenoRename' ]
library(plyr)
unique(Pheno.D$REF)
unique(SNPnames$GenoRename)
## now only keep genotypes and phenotypes that match
#save practice file
#miniSNPs <- SNPs_rename[c(1:3),]
#write.csv(miniSNPs, "miniSNP_practice.csv")
#only keep phenotype rows that match SNP names
SNPMt <- as.data.frame(names(SNPs_rename))
PhenoMatch.D <- Pheno.D
PhenoMatch.D <- PhenoMatch.D[PhenoMatch.D$REF%in% SNPMt$"names(SNPs_rename)", ]
#only keep SNP rows that match phenotype names
#select column with isolate names
PhenoMt.D <- as.data.frame(PhenoMatch.D[,1])
SNPMatch.D <- SNPs_rename
#save first 3 columns: won't match Pheno names
SNPs3 <- SNPs_rename[,c(1:3)]
SNPMatch.D <- SNPMatch.D[names(SNPMatch.D) %in% (PhenoMt.D[,1])]
SNPMatch.D <- SNPMatch.D[ , order(names(SNPMatch.D))]
SNPMatch2.D <- cbind(SNPs3,SNPMatch.D)
#remove 01.01.06 duplicate
SNPMatch2.D <- SNPMatch2.D[,-9]
#sort pheno match
PhenoMatch2.D <- PhenoMatch.D[order(PhenoMatch.D$REF),]
#remove 01.01.06 duplicate
View(PhenoMatch2.D)
PhenoMatch2.D <- PhenoMatch2.D[-6,]
write.csv(SNPMatch2.D, "03_bigRRinput/Domest/binSNP_bigRR_MAF20hp.D.csv")
write.csv(PhenoMatch2.D, "03_bigRRinput/Domest/Gm_Les.Pheno_bigRR.D.csv")
rm(list=ls())
setwd("~/Documents/GitRepos/BcEudicotGWAS/data/RG_soybean/")
#########################
# This makes the bigRR_update run through the GPU
# You need to do this first to mask the native 'bigRR_update' in the bigRR package
# one alternative to family = gaussian(link = identity) is family = poisson(link = log)
## RAN first time WITH POISSON. Lesion size expected to be Gaussian
bigRR_update <- function (obj, Z, family = gaussian(link = identity), tol.err = 1e-06,
tol.conv = 1e-08)
{
w <- as.numeric(obj$u^2/(1 - obj$leverage))
w[w < tol.err] <- tol.err
bigRR(y = obj$y, X = obj$X, Z = Z, family = family, weight = w,
tol.err = tol.err, tol.conv = tol.conv, GPU = TRUE )
}
########################
#NOTE1 FROM RACHEL:  we need bigRR1.3-9 to get GPU option
# must download R-Forge version bigRR1.3-9tar.gz and manually install
# https://r-forge.r-project.org/R/?group_id=1301
# install.packages("bigRR", repos="http://R-Forge.R-project.org")
#NOTE2 FROM RACHEL: need package 'gputools' but CRAN version fails to install
# must first install Nvidia's CUDA toolkit -current version is 7.5
# installed from developer.nvidia.com/cuda-downloads
library(bigRR) #check if version is 1.3-9
#Get genotype data
SNPs <- read.csv("03_bigRRinput/Domest/binSNP_bigRR_MAF20hp.D.csv", row.names = 1)
FullSNPs <- SNPs
SNPs <- FullSNPs
#add a column with position as chr.base
SNPs$Chr.Base <- do.call(paste, c(SNPs[c("X.CHROM","POS")], sep="."))
rownames(SNPs) <- SNPs[,98] #set the new column of chrom.base as rownames - this could maybe be written as: rownames(SNPs) <- SNPs$Chr.Base?
any(duplicated(SNPs$Chr.Base))#check that none are duplicated
SNPs <- SNPs[,4:97] #take out first three cols (X.CHROM, POS, REF) and new last col (Chr.Base). dim(SNPs) should now be [345485, 91], colnames(SNPs) are all Bc Isolates, rownames(SNPs) are all Chr.Base
#makes SNP states numeric (also transposes SNP matrix)
SNPs <- as.matrix(t(SNPs))
for(i in 1:dim(SNPs)[1]) {
SNPs[i,] <- as.numeric(SNPs[i,])
}
#read in phenotype data
Phenos <- read.csv("03_bigRRinput/Domest/Gm_Les.Pheno_bigRR.D.csv", row.names = 1)
View(FullSNPs)
dat <- as.data.frame((Phenos[,2:6]))  #INSERT PHENOTYPE COLUMNS HERE
outpt.HEM <- colnames(SNPs)
thresh.HEM <- list("0.95Thresh" = NA, "0.975Thresh" = NA, "0.99Thresh" = NA, "0.999Thresh" = NA)
#Calculate HEMs for all phenotypes
for(i in 1:dim(dat)[2]) { #i will be each isolate
print(colnames(dat)[i])
MyX <- matrix(1, dim(dat)[1], 1)
Pheno.BLUP.result <- bigRR(y = dat[,i], X = MyX, Z = SNPs, GPU = TRUE)
Pheno.HEM.result <- bigRR_update(Pheno.BLUP.result, SNPs)
outpt.HEM <- cbind(outpt.HEM, Pheno.HEM.result$u)
#Permute Thresholds for Phenos - this is what takes forever
perm.u.HEM <- vector()
for(p in 1:1000) {
if(p %% 10 == 0) {print(paste("Thresh sample:", p, "--", Sys.time()))}
try(temp.Pheno <- sample(dat[,i], length(dat[,i]), replace = FALSE))
try(temp.BLUP  <- bigRR(y = temp.Pheno, X = MyX, Z = SNPs, GPU = TRUE),silent = TRUE)
temp.HEM <- bigRR_update(temp.BLUP, SNPs) #REF change- was bigRR_update(Pheno.BLUP.result...
perm.u.HEM <- c(perm.u.HEM, temp.HEM$u)
=======
rm(list=ls())
setwd("~/Documents/GitRepos/BcEudicotGWAS/data/RG_files")
setwd("~/Projects/BcEudicotGWAS/data/RG_files")
############################################################################
###Plotting the HEM results
#Load plotting package
library(ggplot2)
library(grid)
#Import data (reorganized from script ReformatBigRRouts.R)
HEM.plotdata <- read.csv("04_bigRRoutput/Gm_Les.Pheno_HEM.PlotFormat.csv")
HEM.plotdata$Pos <- as.character(HEM.plotdata$Pos)#ensure that position data is not in scientific notation
HEM.plotdata <- HEM.plotdata[-c(1:2)]
#get threshhold values
HEM.thresh <- read.csv("04_bigRRoutput/Gm_Les.Pheno_HEM.Thresh.csv")
HEM.thresh <- HEM.thresh[,-c(1:2)]
TH99 <- HEM.thresh[3,]
for (i in 2:ncol(TH99)){
assign(paste("TH99_", names(TH99[i]), sep=""),as.numeric(TH99[i]))
}
TH999 <- HEM.thresh[4,]
for (i in 2:ncol(TH999)){
assign(paste("TH999_", names(TH999[i]), sep=""),as.numeric(TH999[i]))
}
TH95 <- HEM.thresh[1,]
for (i in 2:ncol(TH95)){
assign(paste("TH95_", names(TH95[i]), sep=""),as.numeric(TH95[i]))
>>>>>>> b57599025786d6d0501078d2f34c900153021f3f
}
# #Reformat Chromosomes and Positions
HEM.plotdata$Chrom <- gsub("Chromosome", "", HEM.plotdata$Chrom)
HEM.plotdata$Chrom <- as.numeric(as.character(HEM.plotdata$Chrom))
HEM.plotdata$Pos <- as.numeric(as.character(HEM.plotdata$Pos))
#sort dataframe rows in order of Chrom, then Pos
HEM.plotdata2 <- HEM.plotdata[with(HEM.plotdata, order(Chrom, Pos)), ]
#Make plotting variables
HEM.plotdata$Index = NA
ticks = NULL
lastbase = 0
#want to figure out where to add +500 to draw breaks between chromosomes
#Redo the positions to make them sequential		-- accurate position indexing
for (i in unique(HEM.plotdata$Chrom)) {
print(i)
if (i==1) {
HEM.plotdata[HEM.plotdata$Chrom==i, ]$Index=HEM.plotdata[HEM.plotdata$Chrom==i, ]$Pos
}	else {
#changed lastbase+tail to lastbase+max
lastbase=+lastbase+max(subset(HEM.plotdata,HEM.plotdata$Chrom==i-1)$Pos, 1)
HEM.plotdata[HEM.plotdata$Chrom==i, ]$Index=HEM.plotdata[HEM.plotdata$Chrom==i, ]$Pos+lastbase
}
ticks=c(ticks, HEM.plotdata[HEM.plotdata$Chrom==i, ]$Index[floor(length(HEM.plotdata[HEM.plotdata$Chrom==i, ]$Index)/2)+1])
}
<<<<<<< HEAD
#RF-give row names to thresh.HEM and thresh.BLUP so that threshhold values will line up correctly with phenotypes, and you can see which threshold value is displayed
thresh.HEM$"0.95Thresh" <- c("0.95 Thresh", thresh.HEM$"0.95Thresh")
thresh.HEM$"0.975Thresh" <- c("0.975 Thresh", thresh.HEM$"0.975Thresh")
thresh.HEM$"0.99Thresh" <- c("0.99 Thresh", thresh.HEM$"0.99Thresh")
thresh.HEM$"0.999Thresh" <- c("0.999 Thresh", thresh.HEM$"0.999Thresh")
#Write results to output
write.csv(rbind(thresh.HEM$"0.95Thresh",thresh.HEM$"0.975Thresh",thresh.HEM$"0.99Thresh",thresh.HEM$"0.999Thresh",outpt.HEM),"04_bigRRoutput/Domest/Gm_Les.Pheno_HEM.D.csv")
rm(list=ls())
setwd("~/Documents/GitRepos/BcEudicotGWAS/data/RG_soybean/")
SNPs <- read.csv("02_csvprep/Domest/hp_binaryMAF20.csv", row.names = 1)
SNPs_rename <- SNPs
SNPnames <- read.csv("02_csvprep/Domest/Key_SNPnames.csv")
SNPnames <- SNPnames[c(2,4)]
#read in model data with 2 trays dropped
Pheno.D <- read.csv("02_csvprep/Domest/RG_phenoDandW.csv")
#change names from genotype file to isolate names
#File SNPs_rename has columns of isolate genotypes that I want to rename
#File SNPnames is a list indexing original names to match (SNPname), and actual name to replace it (GenoRename)
names( SNPs_rename ) <- SNPnames[ match( names( SNPs_rename ) , SNPnames[ , 'SNPname' ] ) ,'GenoRename' ]
#change names from phenotype file to isolate names
Pheno.D$REF <- SNPnames[ match( Pheno.D$REF , SNPnames[ , 'SNPname' ] ) ,'GenoRename' ]
library(plyr)
unique(Pheno.D$REF)
unique(SNPnames$GenoRename)
## now only keep genotypes and phenotypes that match
#save practice file
#miniSNPs <- SNPs_rename[c(1:3),]
#write.csv(miniSNPs, "miniSNP_practice.csv")
#only keep phenotype rows that match SNP names
SNPMt <- as.data.frame(names(SNPs_rename))
PhenoMatch.D <- Pheno.D
PhenoMatch.D <- PhenoMatch.D[PhenoMatch.D$REF%in% SNPMt$"names(SNPs_rename)", ]
#only keep SNP rows that match phenotype names
#select column with isolate names
PhenoMt.D <- as.data.frame(PhenoMatch.D[,1])
SNPMatch.D <- SNPs_rename
#save first 3 columns: won't match Pheno names
SNPs3 <- SNPs_rename[,c(1:3)]
SNPMatch.D <- SNPMatch.D[names(SNPMatch.D) %in% (PhenoMt.D[,1])]
SNPMatch.D <- SNPMatch.D[ , order(names(SNPMatch.D))]
SNPMatch2.D <- cbind(SNPs3,SNPMatch.D)
#remove 01.01.06 duplicate
SNPMatch2.D <- SNPMatch2.D[,-9]
#sort pheno match
PhenoMatch2.D <- PhenoMatch.D[order(PhenoMatch.D$REF),]
#remove 01.01.06 duplicate
PhenoMatch2.D <- PhenoMatch2.D[-6,]
unique(PhenoMatch2.D$REF)
PhenoMatch2.D$REF
unique(SNPnames$GenoRename)
View(SNPnames)
SNPnames$GenoRename)
SNPnames$GenoRename
View(SNPMatch2.D)
unique(names(SNPMatch2.D))
names(SNPMatch2.D)
PhenoMatch2.D$REF
names(SNPMatch2.D)
Check$PHENOS <- PhenoMatch2.D$REF
myCheck <- data.frame(PHENOS, GENOS)
myCheck <- data.frame(PhenoMatch2.D$REF, names(SNPMatch2.D))
genosList <- names(SNPMatch2.D)
removeList <- c(X.CHROM, POS, REF)
removeList <- c("X.CHROM", "POS", "REF")
setdiff(genosList,removeList)
genosList <- setdiff(genosList,removeList)
myCheck <- data.frame(PhenoMatch2.D$REF, genosList)
View(myCheck)
setdiff(genosList,PhenoMatch2.D$REF)
setdiff(names(SNPMatch2.D, PhenoMatch2.D$REF))
setdiff(names(SNPMatch2.D), PhenoMatch2.D$REF))
setdiff(names(SNPMatch2.D), PhenoMatch2.D$REF)
=======
ticklim=c(min(HEM.plotdata$Index),max(HEM.plotdata$Index))
colnames(HEM.plotdata)[16] <- "myIndex"
#make plots for each phenotype
#it isn't working with the loop for some reason
#for (m in 4:15){ #[5]
jpeg(paste("05_plots/Gm_LesionSize_MAF20_lowTR_", names(HEM.plotdata[5]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[5])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[5]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH95_", names(HEM.plotdata[5]), sep="")), colour = "blue") +
geom_text(aes(0,get(paste("TH95_", names(HEM.plotdata[5]), sep="")), label = ".95 Threshold", vjust = 1.5, hjust = .05), col = "blue")+
geom_hline(yintercept=get(paste("TH99_", names(HEM.plotdata[5]), sep="")), colour = "black") +
geom_text(aes(0,get(paste("TH99_", names(HEM.plotdata[5]), sep="")), label = ".99 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=0)
dev.off()
jpeg(paste("05_plots/Gm_LesionSize_MAF20_lowTR_", names(HEM.plotdata[4]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[4])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[4]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH95_", names(HEM.plotdata[4]), sep="")), colour = "blue") +
geom_text(aes(0,get(paste("TH95_", names(HEM.plotdata[4]), sep="")), label = ".95 Threshold", vjust = 1.5, hjust = .05), col = "blue")+
geom_hline(yintercept=get(paste("TH99_", names(HEM.plotdata[4]), sep="")), colour = "black") +
geom_text(aes(0,get(paste("TH99_", names(HEM.plotdata[4]), sep="")), label = ".99 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=0)
dev.off()
#}
jpeg(paste("05_plots/Gm_LesionSize_MAF20_lowTR_", names(HEM.plotdata[6]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[6])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[6]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH95_", names(HEM.plotdata[6]), sep="")), colour = "blue") +
geom_text(aes(0,get(paste("TH95_", names(HEM.plotdata[6]), sep="")), label = ".95 Threshold", vjust = 1.5, hjust = .05), col = "blue")+
geom_hline(yintercept=get(paste("TH99_", names(HEM.plotdata[6]), sep="")), colour = "black") +
geom_text(aes(0,get(paste("TH99_", names(HEM.plotdata[6]), sep="")), label = ".99 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=0)
dev.off()
jpeg(paste("05_plots/Gm_LesionSize_MAF20_lowTR_", names(HEM.plotdata[7]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[7])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[7]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH95_", names(HEM.plotdata[7]), sep="")), colour = "blue") +
geom_text(aes(0,get(paste("TH95_", names(HEM.plotdata[7]), sep="")), label = ".95 Threshold", vjust = 1.5, hjust = .05), col = "blue")+
geom_hline(yintercept=get(paste("TH99_", names(HEM.plotdata[7]), sep="")), colour = "black") +
geom_text(aes(0,get(paste("TH99_", names(HEM.plotdata[7]), sep="")), label = ".99 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=0)
dev.off()
jpeg(paste("05_plots/Gm_LesionSize_MAF20_lowTR_", names(HEM.plotdata[8]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[8])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[8]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH95_", names(HEM.plotdata[8]), sep="")), colour = "blue") +
geom_text(aes(0,get(paste("TH95_", names(HEM.plotdata[8]), sep="")), label = ".95 Threshold", vjust = 1.5, hjust = .05), col = "blue")+
geom_hline(yintercept=get(paste("TH99_", names(HEM.plotdata[8]), sep="")), colour = "black") +
geom_text(aes(0,get(paste("TH99_", names(HEM.plotdata[8]), sep="")), label = ".99 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=0)
dev.off()
jpeg(paste("05_plots/Gm_LesionSize_MAF20_lowTR_", names(HEM.plotdata[9]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[9])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[9]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH95_", names(HEM.plotdata[9]), sep="")), colour = "blue") +
geom_text(aes(0,get(paste("TH95_", names(HEM.plotdata[9]), sep="")), label = ".95 Threshold", vjust = 1.5, hjust = .05), col = "blue")+
geom_hline(yintercept=get(paste("TH99_", names(HEM.plotdata[9]), sep="")), colour = "black") +
geom_text(aes(0,get(paste("TH99_", names(HEM.plotdata[9]), sep="")), label = ".99 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=0)
dev.off()
jpeg(paste("05_plots/Gm_LesionSize_MAF20_lowTR_", names(HEM.plotdata[10]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[10])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[10]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH95_", names(HEM.plotdata[10]), sep="")), colour = "blue") +
geom_text(aes(0,get(paste("TH95_", names(HEM.plotdata[10]), sep="")), label = ".95 Threshold", vjust = 1.5, hjust = .05), col = "blue")+
geom_hline(yintercept=get(paste("TH99_", names(HEM.plotdata[10]), sep="")), colour = "black") +
geom_text(aes(0,get(paste("TH99_", names(HEM.plotdata[10]), sep="")), label = ".99 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=0)
dev.off()
jpeg(paste("05_plots/Gm_LesionSize_MAF20_lowTR_", names(HEM.plotdata[12]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[12])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[12]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH95_", names(HEM.plotdata[12]), sep="")), colour = "blue") +
geom_text(aes(0,get(paste("TH95_", names(HEM.plotdata[12]), sep="")), label = ".95 Threshold", vjust = 1.5, hjust = .05), col = "blue")+
geom_hline(yintercept=get(paste("TH99_", names(HEM.plotdata[12]), sep="")), colour = "black") +
geom_text(aes(0,get(paste("TH99_", names(HEM.plotdata[12]), sep="")), label = ".99 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=0)
dev.off()
jpeg(paste("05_plots/Gm_LesionSize_MAF20_lowTR_", names(HEM.plotdata[13]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[13])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[13]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH95_", names(HEM.plotdata[13]), sep="")), colour = "blue") +
geom_text(aes(0,get(paste("TH95_", names(HEM.plotdata[13]), sep="")), label = ".95 Threshold", vjust = 1.5, hjust = .05), col = "blue")+
geom_hline(yintercept=get(paste("TH99_", names(HEM.plotdata[13]), sep="")), colour = "black") +
geom_text(aes(0,get(paste("TH99_", names(HEM.plotdata[13]), sep="")), label = ".99 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=0)
dev.off()
jpeg(paste("05_plots/Gm_LesionSize_MAF20_lowTR_", names(HEM.plotdata[14]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[14])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[14]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH95_", names(HEM.plotdata[14]), sep="")), colour = "blue") +
geom_text(aes(0,get(paste("TH95_", names(HEM.plotdata[14]), sep="")), label = ".95 Threshold", vjust = 1.5, hjust = .05), col = "blue")+
geom_hline(yintercept=get(paste("TH99_", names(HEM.plotdata[14]), sep="")), colour = "black") +
geom_text(aes(0,get(paste("TH99_", names(HEM.plotdata[14]), sep="")), label = ".99 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=0)
dev.off()
jpeg(paste("05_plots/Gm_LesionSize_MAF20_lowTR_", names(HEM.plotdata[15]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[15])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[15]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH95_", names(HEM.plotdata[15]), sep="")), colour = "blue") +
geom_text(aes(0,get(paste("TH95_", names(HEM.plotdata[15]), sep="")), label = ".95 Threshold", vjust = 1.5, hjust = .05), col = "blue")+
geom_hline(yintercept=get(paste("TH99_", names(HEM.plotdata[15]), sep="")), colour = "black") +
geom_text(aes(0,get(paste("TH99_", names(HEM.plotdata[15]), sep="")), label = ".99 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=0)
dev.off()
View(HEM.plotdata)
jpeg(paste("plots/MultiPlot/Sp_LesionSize_MAF20_highTR_", names(HEM.plotdata[5]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[5])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[5]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH999_", names(HEM.plotdata[5]), sep=""))) +
geom_text(aes(0,get(paste("TH999_", names(HEM.plotdata[5]), sep="")), label =
".999 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=-0.001)
dev.off()
jpeg(paste("plots/MultiPlot/Sp_LesionSize_MAF20_highTR_", names(HEM.plotdata[6]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[6])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[6]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH999_", names(HEM.plotdata[6]), sep=""))) +
geom_text(aes(0,get(paste("TH999_", names(HEM.plotdata[6]), sep="")), label =
".999 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=-0.001)
dev.off()
jpeg(paste("plots/MultiPlot/Sp_LesionSize_MAF20_highTR_", names(HEM.plotdata[12]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[12])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[12]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH999_", names(HEM.plotdata[12]), sep=""))) +
geom_text(aes(0,get(paste("TH999_", names(HEM.plotdata[12]), sep="")), label =
".999 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=-0.001)
dev.off()
jpeg(paste("plots/MultiPlot/Sp_LesionSize_MAF20_highTR_", names(HEM.plotdata[14]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[14])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[14]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH999_", names(HEM.plotdata[14]), sep=""))) +
geom_text(aes(0,get(paste("TH999_", names(HEM.plotdata[14]), sep="")), label =
".999 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=-0.001)
dev.off()
jpeg(paste("plots/MultiPlot/Sp_LesionSize_MAF20_highTR_", names(HEM.plotdata[15]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[15])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[15]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH999_", names(HEM.plotdata[15]), sep=""))) +
geom_text(aes(0,get(paste("TH999_", names(HEM.plotdata[15]), sep="")), label =
".999 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=-0.001)
dev.off()
#[15]
jpeg(paste("05_plots/Gm_LesionSize_MAF20_highTR_", names(HEM.plotdata[15]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[15])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[15]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH999_", names(HEM.plotdata[15]), sep=""))) +
geom_text(aes(0,get(paste("TH999_", names(HEM.plotdata[15]), sep="")), label =
".999 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=-0.001)
dev.off()
#}
#stop [15]
jpeg(paste("05_plots/Gm_LesionSize_MAF20_highTR_", names(HEM.plotdata[14]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[14])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[14]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH999_", names(HEM.plotdata[14]), sep=""))) +
geom_text(aes(0,get(paste("TH999_", names(HEM.plotdata[14]), sep="")), label =
".999 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=-0.001)
dev.off()
jpeg(paste("05_plots/Gm_LesionSize_MAF20_highTR_", names(HEM.plotdata[12]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[12])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[12]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH999_", names(HEM.plotdata[12]), sep=""))) +
geom_text(aes(0,get(paste("TH999_", names(HEM.plotdata[12]), sep="")), label =
".999 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=-0.001)
dev.off()
jpeg(paste("05_plots/Gm_LesionSize_MAF20_highTR_", names(HEM.plotdata[5]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[5])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[5]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH999_", names(HEM.plotdata[5]), sep=""))) +
geom_text(aes(0,get(paste("TH999_", names(HEM.plotdata[5]), sep="")), label =
".999 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=-0.001)
dev.off()
jpeg(paste("05_plots/Gm_LesionSize_MAF20_highTR_", names(HEM.plotdata[6]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[6])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[6]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH999_", names(HEM.plotdata[6]), sep=""))) +
geom_text(aes(0,get(paste("TH999_", names(HEM.plotdata[6]), sep="")), label =
".999 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=-0.001)
dev.off()
rm(list=ls())
#setwd("~/Documents/GitRepos/BcSolGWAS/data/SNP_files")
setwd("~/Projects/BcEudicotGWAS/data/RG_files/")
HEMdat <- read.csv("04_bigRRoutput/Gm_Les.OA_HEM.csv")
HEMdat <- read.csv("04_bigRRoutput/Gm_OA.Pheno_HEM.csv")
HEMthresh <- HEMdat[1:4,]
HEMdat <- HEMdat[-c(1:4),]
HEMdat2 <- HEMdat
library(tidyr)
names(HEMdat)
View(HEMdat)
tail(unique(HEMdat$X.1))
HEMdat$X.1 <- gsub(pattern = "Chromosome1\\.", replacement = "Chromosome1.0.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome2\\.", replacement = "Chromosome2.0.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome3\\.", replacement = "Chromosome3.0.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome4\\.", replacement = "Chromosome4.0.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome5\\.", replacement = "Chromosome5.0.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome6\\.", replacement = "Chromosome6.0.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome7\\.", replacement = "Chromosome7.0.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome8\\.", replacement = "Chromosome8.0.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome9\\.", replacement = "Chromosome9.0.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome10\\.", replacement = "Chromosome10.0.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome11\\.", replacement = "Chromosome11.0.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome12\\.", replacement = "Chromosome12.0.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome13\\.", replacement = "Chromosome13.0.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome14\\.", replacement = "Chromosome14.0.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome15\\.", replacement = "Chromosome15.0.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome16\\.", replacement = "Chromosome16.0.", HEMdat$X.1)
unique(HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome1\\.0\\.1\\.", replacement = "Chromosome1.1.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome2\\.0\\.1\\.", replacement = "Chromosome2.1.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome2\\.0\\.2\\.", replacement = "Chromosome2.2.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome2\\.0\\.3\\.", replacement = "Chromosome2.3.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome2\\.0\\.4\\.", replacement = "Chromosome2.4.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome2\\.0\\.5\\.", replacement = "Chromosome2.5.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome3\\.0\\.1\\.", replacement = "Chromosome3.1.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome3\\.0\\.2\\.", replacement = "Chromosome3.2.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome4\\.0\\.1\\.", replacement = "Chromosome4.1.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome5\\.0\\.1\\.", replacement = "Chromosome5.1.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome6\\.0\\.1\\.", replacement = "Chromosome6.1.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome6\\.0\\.2\\.", replacement = "Chromosome6.2.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome6\\.0\\.3\\.", replacement = "Chromosome6.3.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome7\\.0\\.1\\.", replacement = "Chromosome7.1.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome7\\.0\\.2\\.", replacement = "Chromosome7.2.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome8\\.0\\.1\\.", replacement = "Chromosome8.1.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome8\\.0\\.2\\.", replacement = "Chromosome8.2.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome9\\.0\\.1\\.", replacement = "Chromosome9.1.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome10\\.0\\.1\\.", replacement = "Chromosome10.1.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome11\\.0\\.1\\.", replacement = "Chromosome11.1.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome12\\.0\\.1\\.", replacement = "Chromosome12.1.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome13\\.0\\.1\\.", replacement = "Chromosome13.1.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome13\\.0\\.2\\.", replacement = "Chromosome13.2.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome14\\.0\\.1\\.", replacement = "Chromosome14.1.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome14\\.0\\.2\\.", replacement = "Chromosome14.2.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome15\\.0\\.1\\.", replacement = "Chromosome15.1.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome15\\.0\\.2\\.", replacement = "Chromosome15.2.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome15\\.0\\.3\\.", replacement = "Chromosome15.3.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome15\\.0\\.4\\.", replacement = "Chromosome15.4.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome16\\.0\\.1\\.", replacement = "Chromosome16.1.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome16\\.0\\.2\\.", replacement = "Chromosome16.2.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome16\\.0\\.3\\.", replacement = "Chromosome16.3.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome16\\.0\\.4\\.", replacement = "Chromosome16.4.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome16\\.0\\.5\\.", replacement = "Chromosome16.5.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome16\\.0\\.6\\.", replacement = "Chromosome16.6.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome16\\.0\\.7\\.", replacement = "Chromosome16.7.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome16\\.0\\.8\\.", replacement = "Chromosome16.8.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome16\\.0\\.9\\.", replacement = "Chromosome16.9.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome16\\.0\\.10\\.", replacement = "Chromosome16.10.", HEMdat$X.1)
HEMdat$X.1 <- gsub(pattern = "Chromosome16\\.0\\.11\\.", replacement = "Chromosome16.11.", HEMdat$X.1)
tail(unique(HEMdat$X.1))
HEMdat2 <- separate (HEMdat, X.1, into = c("Chrom", "Segment", "Pos") )
unique(HEMdat2$Chrom)
unique(HEMdat2$Segment)
write.csv(HEMdat2, "04_bigRRoutput/Gm_OA.Pheno_HEM.PlotFormat.csv")
write.csv(HEMthresh, "04_bigRRoutput/Gm_OA.Pheno_HEM.Thresh.csv")
>>>>>>> b57599025786d6d0501078d2f34c900153021f3f
rm(list=ls())
setwd("~/Documents/GitRepos/BcEudicotGWAS/data/RG_files")
setwd("~/Projects/BcEudicotGWAS/data/RG_files")
library(ggplot2)
library(grid)
HEM.plotdata <- read.csv("04_bigRRoutput/Gm_OA.Pheno_HEM.PlotFormat.csv")
HEM.plotdata$Pos <- as.character(HEM.plotdata$Pos)#ensure that position data is not in scientific notation
HEM.plotdata <- HEM.plotdata[-c(1:2)]
HEM.thresh <- read.csv("04_bigRRoutput/Gm_OA.Pheno_HEM.Thresh.csv")
HEM.thresh <- HEM.thresh[,-c(1:2)]
TH99 <- HEM.thresh[3,]
for (i in 2:ncol(TH99)){
assign(paste("TH99_", names(TH99[i]), sep=""),as.numeric(TH99[i]))
}
<<<<<<< HEAD
########################
#NOTE1 FROM RACHEL:  we need bigRR1.3-9 to get GPU option
# must download R-Forge version bigRR1.3-9tar.gz and manually install
# https://r-forge.r-project.org/R/?group_id=1301
# install.packages("bigRR", repos="http://R-Forge.R-project.org")
#NOTE2 FROM RACHEL: need package 'gputools' but CRAN version fails to install
# must first install Nvidia's CUDA toolkit -current version is 7.5
# installed from developer.nvidia.com/cuda-downloads
library(bigRR) #check if version is 1.3-9
library(bigRR)
?bigRR
which(bigRR)
SNPs <- read.csv("03_bigRRinput/Domest/binSNP_bigRR_MAF20hp.D.csv", row.names = 1)
FullSNPs <- SNPs
SNPs <- FullSNPs
e
SNPs$Chr.Base <- do.call(paste, c(SNPs[c("X.CHROM","POS")], sep="."))
View(SNPs)
rownames(SNPs) <- SNPs[,98] #set the new column of chrom.base as rownames - this could maybe be written as: rownames(SNPs) <- SNPs$Chr.Base?
rownames(SNPs) <- SNPs[,97] #set the new column of chrom.base as rownames - this could maybe be written as: rownames(SNPs) <- SNPs$Chr.Base?
any(duplicated(SNPs$Chr.Base))#check that none are duplicated
SNPs <- SNPs[,4:96] #take out first three cols (X.CHROM, POS, REF) and new last col (Chr.Base). dim(SNPs) should now be [345485, 91], colnames(SNPs) are all Bc Isolates, rownames(SNPs) are all Chr.Base
SNPs <- as.matrix(t(SNPs))
for(i in 1:dim(SNPs)[1]) {
SNPs[i,] <- as.numeric(SNPs[i,])
}
#read in phenotype data
Phenos <- read.csv("03_bigRRinput/Domest/Gm_Les.Pheno_bigRR.D.csv", row.names = 1)
View(Phenos)
View(Phenos)
dat <- as.data.frame((Phenos[,2:6]))  #INSERT PHENOTYPE COLUMNS HERE
outpt.HEM <- colnames(SNPs)
thresh.HEM <- list("0.95Thresh" = NA, "0.975Thresh" = NA, "0.99Thresh" = NA, "0.999Thresh" = NA)
for(i in 1:dim(dat)[2]) { #i will be each isolate
print(colnames(dat)[i])
MyX <- matrix(1, dim(dat)[1], 1)
Pheno.BLUP.result <- bigRR(y = dat[,i], X = MyX, Z = SNPs, GPU = TRUE)
Pheno.HEM.result <- bigRR_update(Pheno.BLUP.result, SNPs)
outpt.HEM <- cbind(outpt.HEM, Pheno.HEM.result$u)
#Permute Thresholds for Phenos - this is what takes forever
perm.u.HEM <- vector()
for(p in 1:1000) {
if(p %% 10 == 0) {print(paste("Thresh sample:", p, "--", Sys.time()))}
try(temp.Pheno <- sample(dat[,i], length(dat[,i]), replace = FALSE))
try(temp.BLUP  <- bigRR(y = temp.Pheno, X = MyX, Z = SNPs, GPU = TRUE),silent = TRUE)
temp.HEM <- bigRR_update(temp.BLUP, SNPs) #REF change- was bigRR_update(Pheno.BLUP.result...
perm.u.HEM <- c(perm.u.HEM, temp.HEM$u)
=======
TH999 <- HEM.thresh[4,]
for (i in 2:ncol(TH999)){
assign(paste("TH999_", names(TH999[i]), sep=""),as.numeric(TH999[i]))
}
TH95 <- HEM.thresh[1,]
for (i in 2:ncol(TH95)){
assign(paste("TH95_", names(TH95[i]), sep=""),as.numeric(TH95[i]))
>>>>>>> b57599025786d6d0501078d2f34c900153021f3f
}
HEM.plotdata$Chrom <- gsub("Chromosome", "", HEM.plotdata$Chrom)
HEM.plotdata$Chrom <- as.numeric(as.character(HEM.plotdata$Chrom))
HEM.plotdata$Pos <- as.numeric(as.character(HEM.plotdata$Pos))
HEM.plotdata2 <- HEM.plotdata[with(HEM.plotdata, order(Chrom, Pos)), ]
HEM.plotdata$Index = NA
ticks = NULL
lastbase = 0
#want to figure out where to add +500 to draw breaks between chromosomes
#Redo the positions to make them sequential		-- accurate position indexing
for (i in unique(HEM.plotdata$Chrom)) {
print(i)
if (i==1) {
HEM.plotdata[HEM.plotdata$Chrom==i, ]$Index=HEM.plotdata[HEM.plotdata$Chrom==i, ]$Pos
}	else {
#changed lastbase+tail to lastbase+max
lastbase=+lastbase+max(subset(HEM.plotdata,HEM.plotdata$Chrom==i-1)$Pos, 1)
HEM.plotdata[HEM.plotdata$Chrom==i, ]$Index=HEM.plotdata[HEM.plotdata$Chrom==i, ]$Pos+lastbase
}
ticks=c(ticks, HEM.plotdata[HEM.plotdata$Chrom==i, ]$Index[floor(length(HEM.plotdata[HEM.plotdata$Chrom==i, ]$Index)/2)+1])
}
<<<<<<< HEAD
#RF-give row names to thresh.HEM and thresh.BLUP so that threshhold values will line up correctly with phenotypes, and you can see which threshold value is displayed
thresh.HEM$"0.95Thresh" <- c("0.95 Thresh", thresh.HEM$"0.95Thresh")
thresh.HEM$"0.975Thresh" <- c("0.975 Thresh", thresh.HEM$"0.975Thresh")
thresh.HEM$"0.99Thresh" <- c("0.99 Thresh", thresh.HEM$"0.99Thresh")
thresh.HEM$"0.999Thresh" <- c("0.999 Thresh", thresh.HEM$"0.999Thresh")
#Write results to output
write.csv(rbind(thresh.HEM$"0.95Thresh",thresh.HEM$"0.975Thresh",thresh.HEM$"0.99Thresh",thresh.HEM$"0.999Thresh",outpt.HEM),"04_bigRRoutput/Domest/Gm_Les.Pheno_HEM.D.csv")
View(dat)
for(i in 1:dim(dat)[2]) { #i will be each isolate
print(colnames(dat)[i])
MyX <- matrix(1, dim(dat)[1], 1)
Pheno.BLUP.result <- bigRR(y = dat[,i], X = MyX, Z = SNPs, GPU = TRUE)
Pheno.HEM.result <- bigRR_update(Pheno.BLUP.result, SNPs)
outpt.HEM <- cbind(outpt.HEM, Pheno.HEM.result$u)
#Permute Thresholds for Phenos - this is what takes forever
perm.u.HEM <- vector()
for(p in 1:1000) {
if(p %% 10 == 0) {print(paste("Thresh sample:", p, "--", Sys.time()))}
try(temp.Pheno <- sample(dat[,i], length(dat[,i]), replace = FALSE))
try(temp.BLUP  <- bigRR(y = temp.Pheno, X = MyX, Z = SNPs, GPU = TRUE),silent = TRUE)
temp.HEM <- bigRR_update(temp.BLUP, SNPs) #REF change- was bigRR_update(Pheno.BLUP.result...
perm.u.HEM <- c(perm.u.HEM, temp.HEM$u)
}
}
colnames(dat)
=======
ticklim=c(min(HEM.plotdata$Index),max(HEM.plotdata$Index))
colnames(HEM.plotdata)[16] <- "myIndex"
View(HEM.plotdata)
colnames(HEM.plotdata)[5] <- "myIndex"
jpeg(paste("05_plots/Gm_OA_MAF20_lowTR_", names(HEM.plotdata[4]), ".ManhattanPlot.jpg", sep=""), width=8, height=4, units='in', res=600)
ggplot(HEM.plotdata, aes(x=myIndex, y=abs(HEM.plotdata[4])))+
theme_bw()+
geom_point(aes(color = factor(Chrom)))+
labs(list(y="SNP Effect Estimate", x="Chromosome position", title=paste("Lesion Size on ", names(HEM.plotdata[4]))))+
guides(col = guide_legend(nrow = 8, title="Chromosome"))+
geom_hline(yintercept=get(paste("TH95_", names(HEM.plotdata[4]), sep="")), colour = "blue") +
geom_text(aes(0,get(paste("TH95_", names(HEM.plotdata[4]), sep="")), label = ".95 Threshold", vjust = 1.5, hjust = .05), col = "blue")+
geom_hline(yintercept=get(paste("TH99_", names(HEM.plotdata[4]), sep="")), colour = "black") +
geom_text(aes(0,get(paste("TH99_", names(HEM.plotdata[4]), sep="")), label = ".99 Threshold", vjust = 1.5, hjust = .05), col = "black")+
expand_limits(y=0)
dev.off()
>>>>>>> b57599025786d6d0501078d2f34c900153021f3f
